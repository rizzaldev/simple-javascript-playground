<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JavaScript Playground</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 900px;
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header h1 {
        font-size: 24px;
        font-weight: 600;
      }

      .header-info {
        font-size: 14px;
        opacity: 0.9;
      }

      .editor-section {
        padding: 30px;
        border-bottom: 2px solid #e0e0e0;
      }

      .editor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .editor-header h2 {
        font-size: 16px;
        color: #333;
        font-weight: 600;
      }

      .button-group {
        display: flex;
        gap: 10px;
      }

      button {
        padding: 8px 20px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .run-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .run-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .clear-btn {
        background: #f5f5f5;
        color: #666;
      }

      .clear-btn:hover {
        background: #e0e0e0;
      }

      .code-editor {
        position: relative;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
        background: #282c34;
      }

      #code-input {
        width: 100%;
        min-height: 300px;
        padding: 15px;
        font-family: "Courier New", Courier, monospace;
        font-size: 14px;
        line-height: 1.6;
        border: none;
        outline: none;
        resize: vertical;
        background: #282c34;
        color: #abb2bf;
        tab-size: 2;
      }

      .output-section {
        padding: 30px;
      }

      .output-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .output-header h2 {
        font-size: 16px;
        color: #333;
        font-weight: 600;
      }

      .clear-output-btn {
        padding: 6px 15px;
        background: #f5f5f5;
        color: #666;
        font-size: 13px;
      }

      #output {
        background: #f8f9fa;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        min-height: 150px;
        max-height: 400px;
        overflow-y: auto;
        font-family: "Courier New", Courier, monospace;
        font-size: 13px;
        line-height: 1.6;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .output-line {
        margin-bottom: 8px;
        padding: 4px 0;
      }

      .output-log {
        color: #333;
      }

      .output-error {
        color: #e74c3c;
        background: #ffeaea;
        padding: 8px;
        border-radius: 4px;
        border-left: 4px solid #e74c3c;
      }

      .output-warn {
        color: #f39c12;
        background: #fff8e1;
        padding: 8px;
        border-radius: 4px;
        border-left: 4px solid #f39c12;
      }

      .output-info {
        color: #3498db;
      }

      .output-success {
        color: #27ae60;
        background: #e8f8f5;
        padding: 8px;
        border-radius: 4px;
        border-left: 4px solid #27ae60;
      }

      .empty-output {
        color: #999;
        font-style: italic;
        text-align: center;
        padding: 40px;
      }

      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .header {
          padding: 15px 20px;
        }

        .header h1 {
          font-size: 20px;
        }

        .editor-section,
        .output-section {
          padding: 20px;
        }

        #code-input {
          min-height: 250px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>⚡ JavaScript Playground</h1>
        <div class="header-info">Write & Run JS Code</div>
      </div>

      <div class="editor-section">
        <div class="editor-header">
          <h2>Code Editor</h2>
          <div class="button-group">
            <button class="clear-btn" onclick="clearCode()">Clear</button>
            <button class="run-btn" onclick="runCode()">▶ Run Code</button>
          </div>
        </div>
        <div class="code-editor">
          <!-- Monaco will replace this div -->
          <div id="editor" style="height: 350px"></div>
        </div>
      </div>

      <div class="output-section">
        <div class="output-header">
          <h2>Output</h2>
          <button class="clear-output-btn" onclick="clearOutput()">
            Clear Output
          </button>
        </div>
        <div id="output">
          <div class="empty-output">Run your code to see output here...</div>
        </div>
      </div>
    </div>

    <script>
      // State management
      let outputElement = document.getElementById("output");
      let editor; // Monaco editor instance

      // Initialize with saved code or default
      function initializeEditor() {
        // Monaco init happens below (async). keep function for consistency.
      }

      // Storage functions (using in-memory storage as per requirements)
      const codeStorage = {
        code: "",
      };

      function getSavedCode() {
        return codeStorage.code;
      }

      function saveCode(code) {
        codeStorage.code = code;
      }

      // Monaco will save on change (set up after load)

      // Output management
      function addOutput(message, type = "log") {
        if (outputElement.querySelector(".empty-output")) {
          outputElement.innerHTML = "";
        }

        const line = document.createElement("div");
        line.className = `output-line output-${type}`;
        line.textContent = message;
        outputElement.appendChild(line);
        outputElement.scrollTop = outputElement.scrollHeight;
      }

      function clearOutput() {
        outputElement.innerHTML =
          '<div class="empty-output">Run your code to see output here...</div>';
      }

      function clearCode() {
        if (editor) {
          editor.setValue("");
        }
        saveCode("");
        clearOutput();
      }

      // Safe code execution
      function runCode() {
        const code = (editor ? editor.getValue() : "").trim();

        if (!code) {
          clearOutput();
          addOutput("No code to execute.", "info");
          return;
        }

        clearOutput();

        // Create sandboxed iframe
        const iframe = document.createElement("iframe");
        iframe.style.display = "none";
        document.body.appendChild(iframe);

        const iframeWindow = iframe.contentWindow;
        const iframeDocument = iframe.contentDocument;

        try {
          // Override console methods in iframe
          iframeWindow.console = {
            log: function (...args) {
              addOutput(args.map((arg) => formatOutput(arg)).join(" "), "log");
            },
            error: function (...args) {
              addOutput(
                "Error: " + args.map((arg) => formatOutput(arg)).join(" "),
                "error"
              );
            },
            warn: function (...args) {
              addOutput(
                "Warning: " + args.map((arg) => formatOutput(arg)).join(" "),
                "warn"
              );
            },
            info: function (...args) {
              addOutput(
                "Info: " + args.map((arg) => formatOutput(arg)).join(" "),
                "info"
              );
            },
          };

          // Capture return value
          const script = iframeDocument.createElement("script");
          script.textContent = `
                           try {
                               ${code}
                           } catch (error) {
                               console.error(error.message);
                               throw error;
                           }
                       `;

          iframeDocument.body.appendChild(script);

          addOutput("✓ Code executed successfully", "success");
        } catch (error) {
          addOutput(`Execution Error: ${error.message}`, "error");
        } finally {
          // Clean up iframe
          setTimeout(() => {
            document.body.removeChild(iframe);
          }, 100);
        }
      }

      // Format output values
      function formatOutput(value) {
        if (value === null) return "null";
        if (value === undefined) return "undefined";
        if (typeof value === "string") return value;
        if (typeof value === "function")
          return `[Function: ${value.name || "anonymous"}]`;
        if (typeof value === "object") {
          try {
            return JSON.stringify(value, null, 2);
          } catch (e) {
            return String(value);
          }
        }
        return String(value);
      }

      // Monaco will handle Tab and many keybindings. Add Ctrl/Cmd+Enter run command below.

      // Initialize
      initializeEditor();

      /* ===================== Monaco Editor load ===================== */
      (function loadMonaco() {
        const MONACO_CDN =
          "https://cdn.jsdelivr.net/npm/monaco-editor@0.39.0/min";
        const loader = document.createElement("script");
        loader.src = MONACO_CDN + "/vs/loader.js";
        loader.onload = () => {
          require.config({ paths: { vs: MONACO_CDN + "/vs" } });
          require(["vs/editor/editor.main"], function () {
            editor = monaco.editor.create(document.getElementById("editor"), {
              value:
                getSavedCode() ||
                `// Write your JavaScript code here...\nconsole.log('Hello, World!');`,
              language: "javascript",
              theme: "vs-dark", // "vs" for light theme
              automaticLayout: true,
              minimap: { enabled: false },
              fontFamily: "Courier New, monospace",
              fontSize: 14,
            });

            // Save on change
            editor.onDidChangeModelContent(() => saveCode(editor.getValue()));

            // Ctrl/Cmd  Enter to run
            editor.addCommand(
              monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter,
              () => {
                runCode();
              }
            );
          });
        };
        document.body.appendChild(loader);
      })();
    </script>

    <style>
      /* Replace textarea styles with editor container */
      #editor {
        width: 100%;
        min-height: 300px;
        padding: 0; /* Monaco controls padding */
        font-family: "Courier New", Courier, monospace;
        font-size: 14px;
        line-height: 1.6;
        border: none;
        outline: none;
        resize: vertical;
        background: #282c34;
        color: #abb2bf;
        tab-size: 2;
      }
    </style>
  </body>
</html>
